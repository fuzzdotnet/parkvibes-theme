// ------------------------------------
// Blocks > Newsletters
// ------------------------------------

@use '../mixins/mq';
@use '../components/button';
@use '../mixins/typography';
@use '../mixins/interaction';

.c-newsletters {
  text-align: center;
  padding: var(--space-400) var(--space-200) var(--space-200);
  border-radius: var(--border-radius-default);
  border: var(--border-width-default) solid color-mix(in srgb, var(--color-site-text) 10%, transparent);
  background-color: color-mix(in srgb, var(--color-site-text) 3%, var(--color-site-background));

  @include mq.mq($from: desktop) {
    padding: var(--space-400);
  }

  // Modifiers: States
  &--loading {
    .c-newsletters__button::after {
      display: block;
    }
  }

  &--success {
    .c-alert--success {
      display: block !important;
    }
  }

  &--error {
    .c-alert--error {
      display: block !important;
    }
  }

  &--invalid {
    .c-alert--invalid {
      display: block !important;
    }
  }

  // Elements: Header
  &__header {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-200);
    margin-bottom: var(--space-300);
    
    @include mq.mq($from: desktop) {
      margin-bottom: var(--space-400);
    }
  }

  &__card {
    position: relative;
    height: 100%;
    
    &:hover {
      .c-newsletters__card-label {
        box-shadow: 0 0 0 var(--border-width-thick) var(--color-site-text);
        background-color: color-mix(in srgb, var(--color-site-text) 3%, var(--color-site-background));
      }
    }
  }

  &__card-input {
    position: absolute;
    opacity: 0;
    pointer-events: none;
    
    &:checked + .c-newsletters__card-label {
      background-color: var(--color-site-background);
      box-shadow: 0 0 0 var(--border-width-thick) var(--color-site-text);
      
      .c-newsletters__card-checkbox::after {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }
    
    &:focus-visible + .c-newsletters__card-label {
      box-shadow: 0 0 0 var(--border-width-thick) var(--color-site-text);
    }
  }

  &__card-label {
    display: flex;
    flex-direction: column;
    height: 100%;
    padding: var(--space-300);
    border: var(--border-width-default) solid color-mix(in srgb, var(--color-site-text) 10%, transparent);
    border-radius: var(--border-radius-default);
    background-color: var(--color-site-background);
    cursor: pointer;
    transition: background-color var(--motion-duration-fast) var(--motion-ease),
                box-shadow var(--motion-duration-fast) var(--motion-ease);

    @include mq.mq($from: desktop) {
      padding: var(--space-400);
    }
  }

  &__card-checkbox {
    position: relative;
    align-self: flex-start;
    width: var(--space-400);
    height: var(--space-400);
    border-radius: var(--border-radius-default);
    border: var(--border-width-thick) var(--border-style-default) var(--color-site-text);
    background-color: var(--color-site-background);
    margin-bottom: var(--space-200);
    display: flex;
    align-items: center;
    justify-content: center;
    
    &::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: var(--space-150);
      height: var(--space-150);
      border-radius: calc(var(--border-radius-default) / 2);
      background-color: var(--color-site-text);
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.8);
      transition: opacity var(--motion-duration-fast) var(--motion-ease),
                  transform var(--motion-duration-fast) var(--motion-ease);
    }
  }

  &__card-content {
    display: flex;
    flex-direction: column;
    flex-grow: 1;
    text-align: left;
  }

  &__card-title {
    @include typography.font($font-weight: semi-bold, $font-size: 125, $line-height: 125);
    font-family: var(--gh-font-heading, var(--font-family-sans-serif));
    margin: 0 0 var(--space-100) 0;
    color: var(--color-site-text);
  }

  &__card-description {
    @include typography.font($font-size: 100, $line-height: 100);
    color: color-mix(in srgb, var(--color-site-text) 85%, transparent);
    margin: 0;
    flex-grow: 1;
  }

  // Elements: Form
  &__form {
    margin-top: var(--space-300);

    @include mq.mq($from: desktop) {
      margin-top: var(--space-400);
    }

    @include mq.mq($from: wide) {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--grid-gap);
      grid-column: 1 / -1;
      
      .c-newsletters__form-group {
        grid-column: 2; // Center column (middle third)
      }
    }
  }

  &__form-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-200);
    flex-grow: 1;
  }

  &__form-label {
    @include typography.font($font-weight: semi-bold, $font-size: 100, $line-height: 100);
    color: var(--color-site-text);
  }

  &__form-input-wrapper {
    display: flex;
    width: 100%;
    padding: var(--space-025);
    border-radius: var(--border-radius-pill);
    background-color: var(--color-site-background);
    border: var(--border-width-default) solid color-mix(in srgb, var(--color-site-text) 10%, transparent);
    box-shadow: 0 0 0 var(--outline-focus-width) color-mix(in srgb, var(--color-site-text) 15%, transparent);
    transition: border-color var(--motion-duration-fast) var(--motion-ease),
                box-shadow var(--motion-duration-fast) var(--motion-ease);
    
    &:focus-within {
      border-color: color-mix(in srgb, var(--color-site-text) 20%, transparent);
      box-shadow: 0 0 0 var(--outline-focus-width) color-mix(in srgb, var(--color-site-text) 25%, transparent);
    }
  }

  // Elements: Alerts
  &__alert {
    @include typography.font($font-size: 100);
    margin: var(--space-300) 0 0 0;
    padding: var(--space-200);
    border-radius: var(--border-radius-default);
    
    &--success {
      background-color: color-mix(in srgb, var(--color-site-text) 5%, var(--color-site-background));
      border: var(--border-width-default) var(--border-style-default) color-mix(in srgb, var(--color-site-text) 20%, transparent);
      color: var(--color-site-text);
    }
    
    &--error {
      background-color: color-mix(in srgb, var(--color-site-text) 8%, var(--color-site-background));
      border: var(--border-width-default) var(--border-style-default) color-mix(in srgb, var(--color-site-text) 25%, transparent);
      color: var(--color-site-text);
    }
  }

  // Form state management for alerts
  &.success &__alert--success,
  &.error &__alert--error,
  &.invalid &__alert--error {
    display: block;
  }
  
  // Loading state: when form has loading class, apply button loading styles
  &.loading &__form-btn {
    @extend .c-btn--loading;
  }

  // Elements: Member Info (for existing members)
  &__member-info {
    padding: var(--space-400);
    border-radius: var(--border-radius-default);
    background-color: color-mix(in srgb, var(--color-site-text) 8%, var(--color-site-background));
    border: var(--border-width-default) var(--border-style-default) color-mix(in srgb, var(--color-site-text) 15%, transparent);
    max-width: var(--line-length);
    text-align: center;
    margin: 0 auto;
  }

  &__member-title {
    @include typography.font($font-weight: bold, $font-size: 150);
    color: var(--color-site-text);
    margin: 0 0 var(--space-100) 0;
  }

  &__member-text {
    @include typography.font($font-size: 100, $line-height: 125);
    color: var(--color-site-text);
    margin: 0 0 var(--space-200) 0;
    
    strong {
      font-weight: var(--font-weight-bold);
    }
  }

  &__member-description {
    @include typography.font($font-size: 100, $line-height: 125);
    color: color-mix(in srgb, var(--color-site-text) 80%, transparent);
    margin: 0 0 var(--space-300) 0;
  }

  // Elements: Preferences Link
  &__preferences {
    margin-top: var(--space-300);
    padding-top: var(--space-300);
    border-top: var(--border-width-default) var(--border-style-default) color-mix(in srgb, var(--color-site-text) 10%, transparent);
    text-align: center;
  }

  &__preferences-text {
    @include typography.font($font-size: 100, $line-height: 125);
    color: color-mix(in srgb, var(--color-site-text) 70%, transparent);
    margin: 0;
  }

  // Elements: Empty State
  &__empty {
    padding: var(--space-600) var(--space-400);
    text-align: center;
    color: color-mix(in srgb, var(--color-site-text) 70%, transparent);
    
    p {
      @include typography.font($font-size: 125, $line-height: 125);
      margin: 0;
    }
  }
}