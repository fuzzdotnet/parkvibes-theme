{{!-- 
  Core Post Content Partial
  
  This partial contains the main post/page content structure that can be reused across:
  - post.hbs (full post view)
  - page.hbs (page view)
  - modal view (enhanced by JavaScript)
  
  Parameters:
  - showHeader: boolean (default: true) - Show title and excerpt header
  - showFooter: boolean (default: true) - Show metadata footer
  - showComments: boolean (default: true) - Show comments section
--}}

{{!-- Preload LCP feature image for faster loading --}}
{{#contentFor "preloads"}}
  {{#if feature_image}}
  {{!-- Use same srcset/sizes logic as the actual image for perfect browser matching --}}
  <link rel="preload"
        href="{{ img_url feature_image size='feature-image-large' format='webp' }}" 
        as="image"
        imagesrcset="{{ img_url feature_image size='feature-image-small' format='webp' }} 600w,
                     {{ img_url feature_image size='feature-image-medium' format='webp' }} 1200w,
                     {{ img_url feature_image size='feature-image-large' format='webp' }} 1800w"
        imagesizes="(max-width: 640px) 100vw, (max-width: 1024px) 80vw, 60vw">
  {{/if}}
{{/contentFor}}

<div class="c-post {{ post_class }} {{> utilities/general }}">
  <div class="c-post__inner">
    
    {{!-- Header Section --}}
    {{#if showHeader}}
      <section class="c-post__header">
        <h1 class="c-post__headline">{{ title }}</h1>

        {{#has tag="video"}}
          {{!-- Video post - hide excerpt --}}
        {{else}}
          {{#if custom_excerpt}}
            <p class="c-post__standfirst">{{{ custom_excerpt }}}</p>
          {{/if}}
        {{/has}}
        
        {{#is "post"}}
          {{> meta/byline }}
          <div class="u-flex u-align-items-center u-flex-direction-column u-gap-100">
            {{> meta/timestamp component="post" }}
            {{> meta/reading-time component="post" }}
          </div>
        {{/is}}
      </section>

      {{!-- Feature Video or Image Section --}}
      {{#has tag="video"}}
        {{#if custom_excerpt}}
          {{!-- Video post with YouTube ID in excerpt - show video --}}
          <figure class="c-post__feature-image-figure">
            <div class="c-post__feature-video-wrapper">
              <iframe class="c-post__feature-video"
                      src="https://www.youtube.com/embed/{{ custom_excerpt }}"
                      title="{{ title }}"
                      frameborder="0"
                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                      referrerpolicy="strict-origin-when-cross-origin"
                      allowfullscreen>
              </iframe>
            </div>
            {{#if feature_image_caption}}
              <figcaption class="c-post__feature-image-caption">{{ feature_image_caption }}</figcaption>
            {{/if}}
          </figure>
        {{else}}
          {{!-- Video tag but no excerpt - fallback to feature image --}}
          {{#if feature_image}}
            <figure class="c-post__feature-image-figure">
              <div class="c-post__feature-image-wrapper">
                <img class="c-post__feature-image"
                     alt="{{#if feature_image_alt}}{{ feature_image_alt }}{{ else }}{{ title }}{{/if}}"
                     src="{{ img_url feature_image size='feature-image-large' format='webp' }}"
                     srcset="{{ img_url feature_image size='feature-image-small' format='webp' }} 600w,
                             {{ img_url feature_image size='feature-image-medium' format='webp' }} 1200w,
                             {{ img_url feature_image size='feature-image-large' format='webp' }} 1800w"
                     sizes="(max-width: 640px) 100vw, (max-width: 1024px) 80vw, 60vw"
                     fetchpriority="high"
                >
              </div>
              {{#if feature_image_caption}}
                <figcaption class="c-post__feature-image-caption">{{ feature_image_caption }}</figcaption>
              {{/if}}
            </figure>
          {{/if}}
        {{/if}}
      {{else}}
        {{!-- Regular post - show feature image --}}
        {{#if feature_image}}
          <figure class="c-post__feature-image-figure">
            <div class="c-post__feature-image-wrapper">
              <img class="c-post__feature-image"
                   alt="{{#if feature_image_alt}}{{ feature_image_alt }}{{ else }}{{ title }}{{/if}}"
                   src="{{ img_url feature_image size='feature-image-large' format='webp' }}"
                   srcset="{{ img_url feature_image size='feature-image-small' format='webp' }} 600w,
                           {{ img_url feature_image size='feature-image-medium' format='webp' }} 1200w,
                           {{ img_url feature_image size='feature-image-large' format='webp' }} 1800w"
                   sizes="(max-width: 640px) 100vw, (max-width: 1024px) 80vw, 60vw"
                   fetchpriority="high"
              >
            </div>
            {{#if feature_image_caption}}
              <figcaption class="c-post__feature-image-caption">{{ feature_image_caption }}</figcaption>
            {{/if}}
          </figure>
        {{/if}}
      {{/has}}
    {{/if}}

    {{!-- Table of Contents Section --}}
    {{> components/table-of-contents }}

    {{!-- Content Section --}}
    <div class="c-content {{ post_class }} {{> utilities/indentation }}">
      {{ content }}
    </div>

    {{!-- Upgrade Section --}}
    {{#unless access}}
      {{> components/upgrade }}
    {{/unless}}

    {{!-- Footer Section --}}
    {{#is "post"}}
      <div class="c-post__footer">
        {{> components/share }}

        <div class="c-post__tags">
          {{#foreach tags}}
            <a href="/tag/{{ slug }}/" class="c-btn c-btn--neutral c-btn--outline c-btn--small">{{ name }}</a>
          {{/foreach}}
        </div>
      </div>
    {{/is}}

    {{!-- Comments Section --}}
    {{#is "post"}}
      {{> components/comments }}
    {{/is}}
    
    {{!-- Modal-specific footer (always rendered for posts, controlled by CSS) --}}
    {{#is "post"}}
      <div class="c-modal-post__full-link">
        <a href="{{ url }}" class="c-btn c-btn--neutral c-btn--outline c-btn--small">{{t "View Full Page" }}</a>
      </div>
    {{/is}}
  </div>
</div>